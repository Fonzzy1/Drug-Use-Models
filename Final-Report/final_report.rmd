---
title : 'Modelling Drug Use in Communities'
author:  'Alfie Chadwick, Kevin Dai, Chrysovalantis Thomopoulos'
output: pdf_document
---

# Introduction

For years, policymakers have been wondering why and how do drugs travel through the community and what they can do to minimise the harm users potentially  cause to themselves and the people surrounding them. In this paper, we aim to understand how drug use and addiction develops in a community and what factors can be tweaked to alter the  long term distributions of drug use, abuse and addiction in the community.

"Number one is the opioid epidemic. It is a scourge across our country. A person dies every 12-and-a-half minutes from an opioid overdose and that’s far too many. Especially when we know that many of those deaths can be prevented." (4)

These were the words of Dr. Adams, the 20th surgeon general of the United States when asked about his main concerns and focus while in his post. 

Substance abuse is not only harmful for one's self but our community. Multiple research articles and papers in the past have adressed the matter and tried to model drug use. We have included some examples below from which we have taken inspiration and made commparisons.

One article in particular by Mushanyu, J, Nyabadza, F, Muchatibaya, G, & Stewart, A G. R. (2016) touches on the importance of an adequate health care system since a limited rehabilitation capacity can increase the chances of a drug abuse epidemic. The methods used in this paper are discussed further along our own.

# Aim
The aim of this project is to produce a model to capture the dynamics of drug use. The model should address how or when individuals become drug users, addicted drug users and abstainers, and have applications in addressing economic and policy decisions.
Investigations by past researchers [REFERENCE] have used compartment models to delineate groups in a population.

# Method

## Initial Model: SIR
It's common to liken drug use to disease, treating drug addiction as an infection that can be recovered from. Using this analogy, we began looking into how diseases are modeled and how we can adapt our own model to fit drug usage.
One of the simplest drug models is the SIR model, a compartment model based on the concept of mass action that sees infections as caused by interactions between infected people and susceptible people.
There are a few reasons that this model is a good starting point for any type of drug modelling:
Firstly, this model is very simple and can be easily adapted to our own needs with extra compartments and transferable conditions.
Secondly, since we are looking at drug use in a population, relying on mass action rather than discrete modeling allows us to further simplify the model.
Thirdly, the idea that addiction is caused by interactions between individuals seems to be a good assumption for drug use as one would expect people to become familiar and subsequently addicted to certain substances by being associated to people with them.

One divergence we made from the most basic SIR model is allowing for relapse from the recovered group back into the infected group. This represents how recovering addicts will become addicted again at a different rate to people who have never used the drug before. However, an important fact is that people can not move back into the susceptible group as addiction is said to last a lifetime.

Our SIR model is defined by the following equations:
$$\frac{dS}{dt} = -\pi_1 * S * I $$
$$\frac{dI}{dt} = \pi_1 * S * I + \pi_2 * R * I - \pi_3 *  I $$
$$\frac{dR}{dt} = -\pi_2 * R * I + \pi_3 * I $$

The parameters $\pi_1$,$\pi_2$ and $\pi_3$ represent the 'infectiousness' of the drug for susceptible and recovering individuals and the rate of recovery from the drug respectively.

We now look at some plots to see how this model behaves for various combinations of our parameters:

```{python, echo = FALSE, SIRsims , fig.show="hold", out.width="50%" }
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from euler_methods import *


SIR(0.001,0.02,0,70,20,10,100)
SIR(0.009, 0, 0.04, 70, 20,10,100)
SIR(0.001,0.05,0.5,70,20,10, 100)
SIR(0.0001,0.001, 0.1, 70,20,10,100)

```

## SUAR Model
The SIR model fails to distingush between different severities of addiction. By grouping the individuals who are trying/testing the drug with people who are addicted we fail to capture the behaviour of people trying the drug without becoming reliant on it.
Because of this, we adapted the SIR model, renaming the infected group to addicted and adding in a new compartment model for users of the drug who are not addicted, labeled as the 'Using' group. Susceptible people will now move into the Using group before moving into the addicted group. Since there are now two groups who are using the drug and interacting with the community, the $I$ terms in the ODEs desribing the SIR now have to be replaced with $U+A$

The new model can now be described with the folowing equations:

$$\frac{dS}{dt} = - \pi_1*S*(A+U) + \pi_2*U   $$
$$\frac{dU}{dt} =  \pi_1*S*(A+U) - \pi_2*U  - \pi_3*U $$
$$\frac{dA}{dt} = \pi_3*U +\pi_4 *(A+U)*R - \pi_5*A $$
$$\frac{dR}{dt} =  \pi_5*A - \pi_4 *(A+U)*R $$

With parameters  $\pi_1$, $\pi_2$,  $\pi_3$, $\pi_4$, and $\pi_5$ being the 'infectiveness' of the drug for susceptible people, the rate that people stop trying the drug, the rate that people become addicted, the 'infectiveness' for recovered people and the recovery rate for addicted people respectivley.

```{python, echo = FALSE, SUARsims, fig.show="hold", out.width="50%" }
   
SUAR(0.01,0.001,0.001, 0.001, 0.001 ,60,20,10,10,100)
SUAR(0.001,0.01,0.001, 0.001, 0.001 ,60,20,10,10,100)
SUAR(0.001,0.001,0.01, 0.001, 0.001 ,60,20,10,10,100)
SUAR(0.001,0.001,0.001, 0.01, 0.001 ,60,20,10,10,100)


```


## SUAR Model with age
Looking at the stationary points of the previous two models (see appendix for derivation), the only long term behaviour is to either kill off the drug and have no users or addicted people or have eveyone in the addicted or recovered group. However, this behaviour is not consistent with what we see in the real world, where we have a consistent number of people using and addicted to the drug, and a consistently high number of people who are susceptible to the drug. To fix we add age groups into the model, grouping them as children, teens, young adults, adults and seniors. Each of these groups have a distinct rate of death and births are porportioal to the number of young adults and adults. Seperating these groups also allows us to set different parameters according to each age group, capturing more nuanced beahviours such as more experiementation in young people.

Another feture we wanted to tackle is how people recover. In the same way that people start using drugs based on interactions with others who are using the drug, we expect people to recover based on interactions with people who aren't using the drug. This can be represented by support groups, concered parents or friends. Furthermore, we can expect people in one agegroup to be influence by different ammoint from each agregreoup. We can store this information with a matrix $I$, where $I_{ij}$ is the magnitude of the influence that group j has on group i.
We can now go in to further simplify this by defining two new terms, the positive and negitive influence on a age group $i$, to be:
$$P_i = \sum{k=1}{5}{I_{ik} * (S_k + R_K)}$$
$$N_i = \sum{k=1}{5}{I_{ik} * (U_k + A_K)}$$

The model now has 20 compartments with both sideways movment within age groups and downwards movement as people age.

Looking across age group 'i', the model can be described as:

$$\frac{dS_i}{dt} = aS_{i-1} + aU_{i-1} \pi_{i-1,2}P_{i-1} - S_i\pi_{i,1}N_i + (1-a)U_i\pi_{i,2}P_i - aSi - d_{i,s}S_i + (b\sum_{k=2}^{3}S_k+U_k+A_k+R_K | i = 0)  $$
$$\frac{dU_i}{dt} =  aS_{i-1}\pi_{i-1,1}N_{i-1} + aU_{i-1} - U_i * \pi_{i,3} - a U_i - U_i\pi_{i,2}P_i + (1-a)S_i\pi_{i,1}N_i - d_{i,U}U_i$$
$$\frac{dA_i}{dt} = aU_{i-1}\pi_{i-1,3} + aA_{i-1} + aR_{i-1}\pi_{i-1,4}N_{i-1} - A_i\pi_{i.5}P_i + (1-a)R_i\pi_{i,4}N_{i}-aA_i + (1-a)U_i\pi_{i,3}- d_{i,A}A_i$$
$$\frac{dR_i}{dt} = aA_{i-1}\pi_{i-1,5}P_{i-1} + aR_{i-1} - aR_i -R_i\pi_{i,4}N_i + (1-a)A_i\pi_{i,5}P_i - d_{i,R}R_I $$

With the paramers being sroted in matrices $\pi$, {d} and {i}, containing row-wise versions of the parameters for the SUAR model, the death rate for each comaprtment, and the influecne each age group has on the other, and scalars $a$ and $b$, which define the aging rate and the birth rate of the population.


```{python, echo = FALSE, SUAR_20sims, fig.show="hold", out.width="50%"  }
aging_rate = 0.05
birth_rate = 0.07
death_rate = 0.1*np.array([[0.2, 0.2, 0.2, 0.2],
                           [0.05, 0.05, 0.05, 0.05],
		           [0.1, 0.1, 0.1, 0.1],
			   [0.2, 0.2, 0.2, 0.2],
			   [0.5, 0.5, 0.5, 0.5]])

X0 = 100 * np.array([[5, 0, 0, 0],
                     [10, 10, 0, 0],
		     [10, 5, 5, 0],
		     [10, 20, 0, 0],
		     [10, 0, 0, 0]])

(n_age_groups, n_status) = np.shape(X0)

I =  0.001*np.array([[0.1, 0.0, 0.2, 0.5, 0.2],
                     [0.0, 0.5, 0.2, 0.2, 0.1],
                     [0.0, 0.1, 0.7, 0.2, 0.0],
                     [0.0, 0.0, 0.1, 0.8, 0.1],
                     [0.0, 0.0, 0.0, 0.5, 0.5]])

P = 0.1*np.array([[0.0, 1.0, 0.5, 0.0, 1.0],
                  [0.5, 0.5, 0.5, 0.8, 0.2],
                  [0.5, 0.5, 0.5, 0.6, 0.2],
                  [0.1, 0.1, 0.5, 0.6, 0.1],
                  [0.0, 0.0, 0.5, 0.9, 0.1]])

SUAR_20(aging_rate,birth_rate,death_rate, I, P, X0,600)

```

## Simplified SUAR Model with age
After building the SUAR model with different age groups, we toyed arroung with various combinations of paramenters to see how the model reacted. 
However, we found that with 20 compartments and 73 parameters, it is realy hard to go through all the combinations to find meaningfull results from the model. We could see that there were stationary points for the population portions, but finding them analyticaly was near impossible. Because of this, we sought to find a way to simplify the model to produce results that are easier to understand. We did this by removing the different age groups all together, while keeping the equations describing the model the same. By removing the age groups, the equations dramaticaly simplify into this form;

              
$$\frac{dS}{dt} = -S\pi_{1}N +U\pi_2P  -d_SS + b(S+U+A+R)  $$
$$\frac{dU}{dt} = S\pi_1N -U\pi_2P - U\pi_3 - d_UU  $$
$$\frac{dA}{dt} = U\pi_3 - A\pi_4P + R\pi_5N - d_AA$$
$$\frac{dR}{dt} = A\pi_4P - R\pi_5N - d_RR $$

```{python, echo = FALSE, SUAR_5Sims, fig.show="hold", out.width="50%" }

SUAR_5(0.01,0.001,0.001, 0.001, 0.001,0.001,[0.0001,0.0005,0.001,0.0001] ,60,20,10,10,300)
SUAR_5(0.001,0.01,0.001, 0.001, 0.001,0.001,[0.0001,0.0005,0.001,0.0001],60,20,10,10,300)
SUAR_5(0.001,0.001,0.01, 0.001, 0.001,0.001,[0.0001,0.0005,0.001,0.0001],60,20,10,10,300)
SUAR_5(0.001,0.001,0.001, 0.01, 0.001,0.001,[0.0001,0.0005,0.001,0.0001],60,20,10,10,300)


```
Looking at this model, it is clear to see that we will only find stationary points when births and deaths are equal. However we also want to see long term trends in growing and shrinking populations. To do this, we look at this model through populaton portions, redefinig the system as:

$$ T = S + U + A + R $$
$$ T' = b(S+U+A+R)  -d_SS -d_UU - d_AA - d_RR $$


$$ \frac{d\frac{S}{N}}{dt} = \frac{(-S\pi_{1}N +U\pi_2P  -d_SS + b(S+U+A+R))T-T'S}{T^2} $$ 
$$ \frac{d\frac{U}{N}}{dt} = \frac{(S\pi_1N -U\pi_2P - U\pi_3 - d_UU )T-T'U}{T^2} $$
$$ \frac{d\frac{A}{N}}{dt} = \frac{(U\pi_3 - A\pi_4P + R\pi_5N - d_AA)T-T'A}{T^2}  $$
$$ \frac{d\frac{R}{N}}{dt} = \frac{(A\pi_4P - R\pi_5N - d_RR )T-T'R}{T^2} $$

Denoting these fractions as s,u,a,r and reformatting the equation using T as a characteristic for population and $\frac{1}{b}$ as a characteristic for time;

$$ s+u+a+r = 1$$
$$ \frac{ds}{dt} = (-s\pi_{1}(u+a)+u\pi_2(s+r)  -d_Ss + 1)-s(1 - d_Ss - d_Uu - d_Aa - d_Rr) $$ 
$$ \frac{du}{dt} = (s\pi_{1}(u+a)-u\pi_2(s+r) - u\pi_3 -d_Uu )-u(1 - d_Ss - d_Uu - d_Aa - d_Rr) $$
$$ \frac{da}{dt} = (u\pi_3 -a\pi_4(s+r) + r\pi_5(u+a) -d_Aa )-a(1 - d_Ss - d_Uu - d_Aa - d_Rr)  $$
$$ \frac{dr}{dt} = (a\pi_4(s+r) - r\pi_5(u+a) -d_Rr )-r(1 - d_Ss - d_Uu - d_Aa - d_Rr)$$



```{python, echo = FALSE, SUARnormsims, fig.show="hold", out.width="50%" }

SUAR_norm(10,1,1,1,1,[0.1,0.5,1,0.1],0.6,0.2,0.1,0.1,50,0.1)
SUAR_norm(1,10,1,1,1,[0.1,0.5,1,0.1],0.6,0.2,0.1,0.1,50,0.1)
SUAR_norm(1,1,10,1,1,[0.1,0.5,1,0.1],0.6,0.2,0.1,0.1,50,0.1)
SUAR_norm(1,1,1,10,1,[0.1,0.5,1,0.1],0.6,0.2,0.1,0.1,50,0.1)


```

# Results


We can think of deaths as a movement from all compartments to the susceptible compartments. This makes it clear that a  stationary point exists when all the people are in the susceptible compartment, meaning the drug is 'extinct'.  Similar, the drug is also extinct when everyone is either in the recovered or susceptible group, as one just has to wait for the recovered people to die for the portion of S to reach 1. These two facts can be seen in appendix 3. Let the stationary point at $s=1$ be the trivial stationary point.

However, for some combinations of parameters, secondary stationary points are found. These non-trivial stationary points could not be found analyticaly using matlab, therefore their existance must be verified in a case by case basis, using the code in apendix 4. 
Note that the all the death parametesr were set to one, meaning that these results are for drugs where the rate of death is independant of compartment. To find results for other sets of death parametrs, alter line 25 of appendix 4.

Using the table of non trivial stationary points  (appendix 10), we can now plot the number of cobninations of parameters that lead to non-trival stationary points pairwise by parameter.


```{python, simforallparams, echo = FALSE}

res = pd.read_csv('../ss.csv')
use =  pd.read_csv('../avg.csv')

res.columns = ['p1','p2','p3','p4','p5', 'extinct']
use.columns =  [ 'p1','p2','p3','p4','p5', 'p_using']

p = ['p1','p2','p3','p4','p5']

xlabels = ['-3','-2','-1','0','1','2','3']


fig, axs = plt.subplots(5, 5)
for i , a in enumerate( p):
    for j , b in enumerate(p):
        if i !=j:
            w = res[[a,b,'extinct']].groupby([a,b]).sum().unstack()
            t = axs[i,j].pcolormesh(w, vmin = 0, vmax = 216)
        if i == 4:
            axs[i,j].set_xticks(np.arange(7) + 0.5, minor=False)
            axs[i,j].set_xticklabels(xlabels, fontdict=None, minor=False)
            axs[i,j].set_xlabel('Log2(' + b +')')
        else:
            axs[i,j].get_xaxis().set_visible(False)
        if j == 0 :
            axs[i,j].set_yticks(np.arange(7) + 0.5, minor=False)
            axs[i,j].set_yticklabels(xlabels, fontdict=None, minor=False)
            axs[i,j].set_ylabel('Log2(' + a +')')
        else:
            axs[i,j].get_yaxis().set_visible(False)

fig.subplots_adjust(right=0.8)
cbar_ax = fig.add_axes([0.85, 0.15, 0.05, 0.7])
c = fig.colorbar(t, cax=cbar_ax)
fig.suptitle("Number of combinations that have Non-trivial stationary points \n ds=1, du=1, da=1,dr=1 s0=0.6, u0=0.2, a0=0.1, r0=0.1, Total Sims = 216")
plt.show()

```

From this plot, one can see a big factor that influences the creation of these non-trival stationary points is the magnitude of $\pi_1$, an in a lesser extent the ratio of $\pi_1$ and $\pi_2$. In this case, any births will rapidly transition to the using category, meaning that they then have the potential to become addicted. 

Another result one can take from the data is the number of people who are using or addicted to the drug at the pseudo-stationary points, as shown in these plots below.

```{python,pssp, echo = FALSE}
fig, axs = plt.subplots(5, 5)
for i , a in enumerate( p):
    for j , b in enumerate(p):
        if i !=j:
            w = use[[a,b,'p_using']].groupby([a,b]).mean().unstack()
            t = axs[i,j].pcolormesh(w, vmin = 0, vmax = 1)
        if i == 4:
            axs[i,j].set_xticks(np.arange(7) + 0.5, minor=False)
            axs[i,j].set_xticklabels(xlabels, fontdict=None, minor=False)
            axs[i,j].set_xlabel('Log2(' + b +')')
        else:
            axs[i,j].get_xaxis().set_visible(False)
        if j == 0 :
            axs[i,j].set_yticks(np.arange(7) + 0.5, minor=False)
            axs[i,j].set_yticklabels(xlabels, fontdict=None, minor=False)
            axs[i,j].set_ylabel('Log2(' + a +')')
        else:
            axs[i,j].get_yaxis().set_visible(False)

fig.subplots_adjust(right=0.8)
cbar_ax = fig.add_axes([0.85, 0.15, 0.05, 0.7])
c = fig.colorbar(t, cax=cbar_ax)
fig.suptitle("Average portion of people using or addicted at non-Trivial Statioanry Points \n ds=1, du=1, da=1,dr=1 s0=0.6, u0=0.2, a0=0.1, r0=0.1, Total Sims = 216")
plt.show()
```
Looking at these plots we can see the following behaviours:

* Bigger $\pi_1$ -> Higher Mean
* Bigger $\pi_2$ -> Lower Mean
* Bigger $\pi_3$ -> Lower Mean
* Bigger $\pi_4$ -> Lower Mean
* Bigger $\pi_5$ -> Higher Mean

Therefore, in terms of tweaking the long term state of drug use in communities, the best way to minimise drug use is to minimise $\pi_1$ such that the drug will become extinct. If this cant be done, the number of people using or addicted to drugs can be minimised by lowering the values of $\pi_2, \pi_3, \pi_4$ or maximising the value of $\pi_5$ to make the pseudo-stationay point have a maxal number of people not using the drug.

# Discussion

// Compare our model
// Inspirations
// Limitations
// Future Tweaks

In this part of the discussion, we aim to compare our model with the one presented by
Mushanyu, J, Nyabadza, F, Muchatibaya, G, & Stewart, A G. R. (2016) and decide what future tweaks and changes can be made to further improve our own model.
The use of protein and ligand bonding as well as the Hill function is quite interesting
since the authors have effectively linked Biological Modelling and altered it to their own advantage. 
Firstly, protein and a ligand bonding forming a new product has equivalently been transformed into addicts connecting and creating a bond with a recovery center and as a result being transformed themselves. They have also used the term ‘Cooperativity’ as a parameter which is how other rehabilitants affect other users either negatively or positively. 
In our case we have used positive and negative influence of age groups and/or compartment models on each other based on interactions instead of cooperativity. Cooperativity is a way more specific and detailed parameter whilst our own is more general. Applying both the protein-ligand equivalent and the subdivision of a Recovered Cooperation parameter could help our model in the future.
Secondly, the Hill Function was adjusted to suit their drug model. They split Rehabilitation in two sections. Outpatient rehabilitation allows the user to stay productive and around their family while inpatient rehabilitation involves rehabilitation centers and more strict rules. Of course, limited resources and capacities affect users’ choices. The rehabilitation capacities are limited in their own way as well since in a lot of countries the health care department is not adequate to help all users which makes the model realistic and pragmatic.
We on the other hand have sub compartments in the Infected Area which we have split into Using and Addicted compartments while we have not done the same in the Susceptible and Recovered compartments. Integrating those in the future as well as saturation effects can make our model more effective.





# Conclusion

// Conclusion




# Appendix

## Appendix 1 : Stationary points of SIR model

$$0 = -\pi_1 * S * I $$
$$0 = \pi_1 * S * I + \pi_2 * R * I - \pi_3 *  I $$
$$0 = -\pi_2 * R * I + \pi_3 * I $$

Therefore either $\pi_1$, $S$ or $I$ must be 0

If $I = 0$:

$$0 = -\pi_1 * S * 0 $$
$$0 = \pi_1 * S * 0 + \pi_2 * R * 0 - \pi_3 *  0 $$
$$0 = -\pi_2 * R * 0 + \pi_3 * 0 $$

Therefore any point [$S$,0,$R$] is stationary.

If $\pi_1 = 0$ or $S=0$:

$$0 =  0 * I $$
$$0 = 0 * I + \pi_2 * R * I - \pi_3 *  I $$
$$0 = -\pi_2 * R * I + \pi_3 * I $$

Therefore:

$$ \pi_2 * R * I - \pi_3 *  I = - \pi_2 * R * I + \pi_3 *  I  $$
$$ \pi_2 * R * I = \pi_3 * I $$
:q
$$ R:I = \pi_3:\pi_2 $$

Therefore any point [0, $\frac {P_{total}*\pi_2}{\pi_2 + \pi_3}$ ,$\frac {P_{total}*\pi_3}{\pi_2 + \pi_3}$]

## Appendix 2 : Stationary points of SUAR

$$0 = - \pi_1*S*(A+U) + \pi_2*U   $$
$$0 =  \pi_1*S*(A+U) - \pi_2*U  - \pi_3*U $$
$$0 = \pi_3*U +\pi_4 *(A+U)*R - \pi_5*A $$
$$0 =  \pi_5*A - \pi_4 *(A+U)*R $$

By combing the first two and last two equations, one can see that if the parameters are non 0, $U=0$. Therefore:

$$ 0 = \pi_1*S*A $$
$$0 = \pi_4 *A*R - \pi_5*A $$
$$0 =  \pi_5*A - \pi_4 *A*R $$

Therefore $S = 0$ or $A = 0$
In the case $A = 0$, any point [$S$,0,0,$R$] will be stationary

In the case $S=0$
$$ \pi_4*A*R = \pi_5*A$$
$$R:A = \pi_5:\pi_4$$

Therefore any point [0,0, $\frac {P_{total}*\pi_4}{\pi_4 + \pi_5}$ ,$\frac {P_{total}*\pi_5}{\pi_4 + \pi_5}$]

## Apendix 3: Critical Points of Simplified SUAR model

When s = 1:
$$ s = 1$$
$$ \frac{ds}{dt} = (-d_Ss + 1)-s(1 - d_Ss) = (1-S)(1-d_Ss)  = 0 $$ 
$$ \frac{du}{dt} = 0 $$
$$ \frac{da}{dt} = 0  $$
$$ \frac{dr}{dt} = 0  $$


When s+r = 1:
$$ s+r = 1$$
$$ s = 1 - r $$

$$ \frac{ds}{dt} = (-d_Ss + b)-s(1 - d_Ss - d_Rr)  = (1 -s)*(1 + d_r*s - d_s*s)$$ 
$$ \frac{du}{dt} = 0 $$
$$ \frac{da}{dt} = 0  $$
$$ \frac{dr}{dt} = (-d_Rr )-r(1 - d_Ss - d_Rr) = (s - 1)*(1 + d_r*s - d_s*s)$$


## Appendix 4: Matlab code for generating conditional Stationary Points

```{octave, eval = FALSE}
syms s u a r p1 p2 p3 p4 p5 ds du da dr


ode1 =  (-s*p1*(u+a)+u*p2*(s+r)  -ds*s + 1)-s *(1 - ds*s - du*u - da*a - dr*r);
ode2 =  (s*p1*(u+a)-u*p2*(s+r) - u*p3 -du*u )-u*(1 - ds*s - du*u - da*a - dr*r) ;
ode3 =  (u*p3 -a*p4*(s+r) + r*p5*(u+a) -da*a )-a*(1 - ds*s - du*u - da*a - dr*r);
ode4 =  (a*p4*(s+r) - r*p5*(u+a) -dr*r )-r*(1 - ds*s -du*u - da*a - dr*r);
sums = s+u+a+r;



odes = [ode1 == 0, ode2 == 0, ode3 == 0 , ode4 == 0, sums  == 1, s>=0, u >= 0, a >=0, r>=0];


ss = [];
avg = [];

k = 3;

for p1i = -k:k
    for p2i   = -k:k
        for p3i  = -k:k
            for p4i  = -k:k
                for p5i = -k:k
                    [p1, p2, p3, p4, p5, ds, du, da, dr] = deal(2^p1i, 2^p2i, 2^p3i, 2^p4i, 2^p5i,1,1,1,1);
                    sol = solve(subs(odes),'Real',true);
                    ss = [ss ; [p1i,p2i,p3i,p4i,p5i,length(sol.s) - 1]];
                    if length(sol.s) > 1
                        avg = [avg ; [p1i,p2i,p3i,p4i,p5i,mean(sol.u(2:length(sol.u)) + sol.a(2:length(sol.a)))]];
                    end
                end
            end
        end
    end
end



writematrix(double(avg),'avg.csv')
writematrix(double(ss), 'ss.csv')
```

## Appendix 5: Pyhton code for simulating SIR model

```{python, echo = FALSE}

from inspect import getsource as gs
print(gs(SIR))
 
```

## Appendix 6: Pyhton code for simulating SUAR model

```{python, echo = FALSE}

from inspect import getsource as gs
print(gs(SUAR))
 
```
## Appendix 7: Pyhton code for simulating 20 compartment SUAR model

```{python, echo = FALSE}

from inspect import getsource as gs
print(gs(SUAR_20))
 
```
## Appendix 8: Pyhton code for simulating 5 compartment SUAR model

```{python, echo = FALSE}

from inspect import getsource as gs
print(gs(SUAR_5))
 
```

## Appendix 9: Pyhton code for simulating  5 compartment dimensionless SUAR model

```{python, echo = FALSE}

from inspect import getsource as gs
print(gs(SUAR_norm))
 
```

## Apendix 10: Number of non-trivial stationary points

```{r, echo = FALSE}
library('knitr')

ss <- read.csv(file = '../ss.csv')
colnames(ss) <- c('log2(p1)','log2(p2)','log2(p3)','log2(p4)','log2(p5)', '#Non-Trivial SS')
kable(ss)
```

## Apendix 11: Avarage of u + a for non-trivial
```{r, echo = FALSE}

avg <- read.csv(file = '../avg.csv')
colnames(avg) <- c('log2(p1)','log2(p2)','log2(p3)','log2(p4)','log2(p5)', 'a+u')
kable(avg)
```


# References

 1) Mushanyu, J, Nyabadza, F, Muchatibaya, G, & Stewart, A G. R. (2016). Modelling Drug Abuse Epidemics in the Presence of Limited Rehabilitation Capacity. Bulletin of Mathematical Biology, 78(12), 2364–2389. https://doi.org/10.1007/s11538-016-0218-5
 2) Mushanyu, J, Nyabadza, F, & Stewart, A G R. (2015). Modelling the trends of inpatient and outpatient rehabilitation for methamphetamine in the Western Cape province of South Africa. BMC Research Notes, 8(796), 797–797. https://doi.org/10.1186/s13104-015-1741-4
 3) Betterhealth.vic.gov.au. 2021. Drug use in Victoria - Better Health Channel. [online] Available at: <https://www.betterhealth.vic.gov.au/health/healthyliving/drug-use-in-victoria> [Accessed 21 October 2021].
 4) Thedoctors.com. 2021. U.S. Surgeon General Discusses the Opioid Epidemic. [online] Available at: <https://www.thedoctors.com/articles/u.s.-surgeon-general-discusses-the-opioid-epidemic/> [Accessed 21 October 2021].



